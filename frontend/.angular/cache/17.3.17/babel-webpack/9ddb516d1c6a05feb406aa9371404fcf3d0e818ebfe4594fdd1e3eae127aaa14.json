{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/reports.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../components/vin-input/vin-input.component\";\nimport * as i4 from \"../../components/paywall-modal/paywall-modal.component\";\nimport * as i5 from \"../../components/report-card/report-card.component\";\nfunction HomeComponent_div_35_app_report_card_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-report-card\", 22);\n    i0.ɵɵlistener(\"download\", function HomeComponent_div_35_app_report_card_4_Template_app_report_card_download_0_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.onDownloadReport($event));\n    })(\"retry\", function HomeComponent_div_35_app_report_card_4_Template_app_report_card_retry_0_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.onRetryReport($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const report_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"report\", report_r4);\n  }\n}\nfunction HomeComponent_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"h2\", 19);\n    i0.ɵɵtext(2, \"\\u0412\\u0430\\u0448\\u0438 \\u043E\\u0442\\u0447\\u0451\\u0442\\u044B\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 20);\n    i0.ɵɵtemplate(4, HomeComponent_div_35_app_report_card_4_Template, 1, 1, \"app-report-card\", 21);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.userReports);\n  }\n}\nexport let HomeComponent = /*#__PURE__*/(() => {\n  class HomeComponent {\n    constructor(reportsService) {\n      this.reportsService = reportsService;\n      this.userReports = [];\n      this.showPaywall = false;\n      this.currentVin = '';\n      this.currentReportId = '';\n    }\n    ngOnInit() {\n      this.loadUserReports();\n    }\n    onVinSubmitted(vin) {\n      this.currentVin = vin;\n      this.reportsService.requestReport(vin).subscribe({\n        next: response => {\n          if (response.status === 'available') {\n            // Отчёт уже доступен\n            this.loadUserReports();\n          } else if (response.status === 'payment_required') {\n            // Требуется оплата\n            this.currentReportId = response.reportId;\n            this.showPaywall = true;\n          } else if (response.status === 'generating') {\n            // Отчёт генерируется\n            this.loadUserReports();\n          }\n        },\n        error: error => {\n          console.error('Ошибка запроса отчёта:', error);\n          alert('Ошибка при запросе отчёта. Попробуйте снова.');\n        }\n      });\n    }\n    onDownloadReport(reportId) {\n      this.reportsService.downloadReport(reportId).subscribe({\n        next: response => {\n          window.open(response.downloadUrl, '_blank');\n        },\n        error: error => {\n          console.error('Ошибка скачивания:', error);\n          alert('Ошибка при скачивании отчёта.');\n        }\n      });\n    }\n    onRetryReport(reportId) {\n      // В реальном приложении здесь бы был запрос на повторную генерацию\n      console.log('Retry report:', reportId);\n      this.loadUserReports();\n    }\n    onClosePaywall() {\n      this.showPaywall = false;\n      this.currentVin = '';\n      this.currentReportId = '';\n    }\n    onPaymentSuccess() {\n      this.loadUserReports();\n    }\n    loadUserReports() {\n      this.reportsService.getUserReports().subscribe({\n        next: reports => {\n          this.userReports = reports;\n        },\n        error: error => {\n          console.error('Ошибка загрузки отчётов:', error);\n        }\n      });\n    }\n    static {\n      this.ɵfac = function HomeComponent_Factory(t) {\n        return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.ReportsService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: HomeComponent,\n        selectors: [[\"app-home\"]],\n        decls: 37,\n        vars: 4,\n        consts: [[\"vinInput\", \"\"], [1, \"min-h-screen\", \"bg-gray-50\", \"py-12\"], [1, \"max-w-4xl\", \"mx-auto\", \"px-4\", \"sm:px-6\", \"lg:px-8\"], [1, \"text-center\", \"mb-12\"], [1, \"text-4xl\", \"font-bold\", \"text-gray-900\", \"mb-4\"], [1, \"text-xl\", \"text-gray-600\", \"mb-8\"], [1, \"mb-12\"], [3, \"vinSubmitted\"], [1, \"grid\", \"md:grid-cols-3\", \"gap-8\", \"mb-12\"], [1, \"text-center\"], [1, \"bg-primary-100\", \"rounded-full\", \"w-16\", \"h-16\", \"flex\", \"items-center\", \"justify-center\", \"mx-auto\", \"mb-4\"], [\"fill\", \"none\", \"stroke\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"w-8\", \"h-8\", \"text-primary-600\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"], [1, \"text-lg\", \"font-medium\", \"text-gray-900\", \"mb-2\"], [1, \"text-gray-600\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"], [\"class\", \"mb-12\", 4, \"ngIf\"], [3, \"close\", \"paymentSuccess\", \"isVisible\", \"vin\", \"reportId\"], [1, \"text-2xl\", \"font-bold\", \"text-gray-900\", \"mb-6\"], [1, \"grid\", \"gap-4\"], [3, \"report\", \"download\", \"retry\", 4, \"ngFor\", \"ngForOf\"], [3, \"download\", \"retry\", \"report\"]],\n        template: function HomeComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 3)(3, \"h1\", 4);\n            i0.ɵɵtext(4, \" \\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u0435 \\u043F\\u043E\\u043B\\u043D\\u044B\\u0439 \\u043E\\u0442\\u0447\\u0451\\u0442 \\u043F\\u043E VIN \\u043D\\u043E\\u043C\\u0435\\u0440\\u0443 \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"p\", 5);\n            i0.ɵɵtext(6, \" \\u0423\\u0437\\u043D\\u0430\\u0439\\u0442\\u0435 \\u0438\\u0441\\u0442\\u043E\\u0440\\u0438\\u044E \\u0430\\u0432\\u0442\\u043E\\u043C\\u043E\\u0431\\u0438\\u043B\\u044F, \\u0430\\u0432\\u0430\\u0440\\u0438\\u0438, \\u0441\\u0435\\u0440\\u0432\\u0438\\u0441\\u043D\\u044B\\u0435 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B \\u0438 \\u043C\\u043D\\u043E\\u0433\\u043E\\u0435 \\u0434\\u0440\\u0443\\u0433\\u043E\\u0435 \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"div\", 6)(8, \"app-vin-input\", 7, 0);\n            i0.ɵɵlistener(\"vinSubmitted\", function HomeComponent_Template_app_vin_input_vinSubmitted_8_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onVinSubmitted($event));\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(10, \"div\", 8)(11, \"div\", 9)(12, \"div\", 10);\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(13, \"svg\", 11);\n            i0.ɵɵelement(14, \"path\", 12);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(15, \"h3\", 13);\n            i0.ɵɵtext(16, \"\\u041F\\u043E\\u043B\\u043D\\u0430\\u044F \\u0438\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"p\", 14);\n            i0.ɵɵtext(18, \"\\u0410\\u0432\\u0430\\u0440\\u0438\\u0438, \\u0441\\u0435\\u0440\\u0432\\u0438\\u0441\\u043D\\u044B\\u0435 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B, \\u043E\\u0442\\u0437\\u044B\\u0432\\u044B \\u0438 \\u043C\\u043D\\u043E\\u0433\\u043E\\u0435 \\u0434\\u0440\\u0443\\u0433\\u043E\\u0435\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(19, \"div\", 9)(20, \"div\", 10);\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(21, \"svg\", 11);\n            i0.ɵɵelement(22, \"path\", 15);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(23, \"h3\", 13);\n            i0.ɵɵtext(24, \"\\u0414\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435 \\u0446\\u0435\\u043D\\u044B\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"p\", 14);\n            i0.ɵɵtext(26, \"$2 \\u0437\\u0430 \\u043E\\u0442\\u0447\\u0451\\u0442 \\u0438\\u043B\\u0438 $99 \\u0437\\u0430 100 \\u043E\\u0442\\u0447\\u0451\\u0442\\u043E\\u0432\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(27, \"div\", 9)(28, \"div\", 10);\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(29, \"svg\", 11);\n            i0.ɵɵelement(30, \"path\", 16);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(31, \"h3\", 13);\n            i0.ɵɵtext(32, \"\\u0411\\u0435\\u0437\\u043E\\u043F\\u0430\\u0441\\u043D\\u043E\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"p\", 14);\n            i0.ɵɵtext(34, \"\\u0417\\u0430\\u0449\\u0438\\u0449\\u0451\\u043D\\u043D\\u044B\\u0435 \\u043F\\u043B\\u0430\\u0442\\u0435\\u0436\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 Stripe\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(35, HomeComponent_div_35_Template, 5, 1, \"div\", 17);\n            i0.ɵɵelementStart(36, \"app-paywall-modal\", 18);\n            i0.ɵɵlistener(\"close\", function HomeComponent_Template_app_paywall_modal_close_36_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onClosePaywall());\n            })(\"paymentSuccess\", function HomeComponent_Template_app_paywall_modal_paymentSuccess_36_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onPaymentSuccess());\n            });\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(35);\n            i0.ɵɵproperty(\"ngIf\", ctx.userReports.length > 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"isVisible\", ctx.showPaywall)(\"vin\", ctx.currentVin)(\"reportId\", ctx.currentReportId);\n          }\n        },\n        dependencies: [i2.NgForOf, i2.NgIf, i3.VinInputComponent, i4.PaywallModalComponent, i5.ReportCardComponent],\n        encapsulation: 2\n      });\n    }\n  }\n  return HomeComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}